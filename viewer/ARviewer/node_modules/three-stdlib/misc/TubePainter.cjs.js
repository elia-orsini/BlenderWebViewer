"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var r=require("three");exports.TubePainter=function(){const a=3e6,t=new r.BufferAttribute(new Float32Array(a),3);t.usage=r.DynamicDrawUsage;const e=new r.BufferAttribute(new Float32Array(a),3);e.usage=r.DynamicDrawUsage;const o=new r.BufferAttribute(new Float32Array(a),3);o.usage=r.DynamicDrawUsage;const n=new r.BufferGeometry;n.setAttribute("position",t),n.setAttribute("normal",e),n.setAttribute("color",o),n.drawRange.count=0;const y=new r.MeshStandardMaterial({vertexColors:!0}),c=new r.Mesh(n,y);c.frustumCulled=!1;const u=new r.Vector3,p=new r.Vector3,s=new r.Vector3,i=new r.Vector3,d=new r.Color(16777215);let l=1;function A(a,y,c,A){if(0===a.distanceToSquared(y))return;let w=n.drawRange.count;const f=function(a){const t=2*Math.PI,e=[],o=.01*a;for(let a=0;a<10;a++){const n=a/10*t;e.push(new r.Vector3(Math.sin(n)*o,Math.cos(n)*o,0))}return e}(l);for(let r=0,n=f.length;r<n;r++){const l=f[r],g=f[(r+1)%n];u.copy(l).applyMatrix4(A).add(y),p.copy(g).applyMatrix4(A).add(y),s.copy(g).applyMatrix4(c).add(a),i.copy(l).applyMatrix4(c).add(a),u.toArray(t.array,3*(w+0)),p.toArray(t.array,3*(w+1)),i.toArray(t.array,3*(w+2)),p.toArray(t.array,3*(w+3)),s.toArray(t.array,3*(w+4)),i.toArray(t.array,3*(w+5)),u.copy(l).applyMatrix4(A).normalize(),p.copy(g).applyMatrix4(A).normalize(),s.copy(g).applyMatrix4(c).normalize(),i.copy(l).applyMatrix4(c).normalize(),u.toArray(e.array,3*(w+0)),p.toArray(e.array,3*(w+1)),i.toArray(e.array,3*(w+2)),p.toArray(e.array,3*(w+3)),s.toArray(e.array,3*(w+4)),i.toArray(e.array,3*(w+5)),d.toArray(o.array,3*(w+0)),d.toArray(o.array,3*(w+1)),d.toArray(o.array,3*(w+2)),d.toArray(o.array,3*(w+3)),d.toArray(o.array,3*(w+4)),d.toArray(o.array,3*(w+5)),w+=6}n.drawRange.count=w}const w=new r.Vector3(0,1,0),f=new r.Vector3,g=new r.Vector3,M=new r.Matrix4,x=new r.Matrix4;let m=0;return{mesh:c,moveTo:function(r){f.copy(r),M.lookAt(g,f,w),g.copy(r),x.copy(M)},lineTo:function(r){f.copy(r),M.lookAt(g,f,w),A(f,g,M,x),g.copy(f),x.copy(M)},setSize:function(r){l=r},update:function(){const r=m,a=n.drawRange.count;r!==a&&(t.updateRange.offset=3*r,t.updateRange.count=3*(a-r),t.needsUpdate=!0,e.updateRange.offset=3*r,e.updateRange.count=3*(a-r),e.needsUpdate=!0,o.updateRange.offset=3*r,o.updateRange.count=3*(a-r),o.needsUpdate=!0,m=n.drawRange.count)}}};
