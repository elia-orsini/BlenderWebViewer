"use strict";module.exports=class{constructor(e){this.buffers=new WeakMap,this.device=e}get(e){return this.buffers.get(e)}remove(e){const t=this.buffers.get(e);t&&(t.buffer.destroy(),this.buffers.delete(e))}update(e,t=!1,r=null){let s=this.buffers.get(e);void 0===s?(null===r&&(r=!0===t?GPUBufferUsage.INDEX:GPUBufferUsage.VERTEX),s=this._createBuffer(e,r),this.buffers.set(e,s)):r&&r!==s.usage?(s.buffer.destroy(),s=this._createBuffer(e,r),this.buffers.set(e,s)):s.version<e.version&&(this._writeBuffer(s.buffer,e),s.version=e.version)}_createBuffer(e,t){const r=e.array,s=r.byteLength+(4-r.byteLength%4)%4,f=this.device.createBuffer({size:s,usage:t|GPUBufferUsage.COPY_DST,mappedAtCreation:!0});return new r.constructor(f.getMappedRange()).set(r),f.unmap(),e.onUploadCallback(),{version:e.version,buffer:f,usage:t}}_writeBuffer(e,t){const r=t.array,s=t.updateRange;-1===s.count?this.device.queue.writeBuffer(e,0,r,0):(this.device.queue.writeBuffer(e,0,r,s.offset*r.BYTES_PER_ELEMENT,s.count*r.BYTES_PER_ELEMENT),s.count=-1)}};
