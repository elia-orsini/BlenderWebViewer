"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("@babel/runtime/helpers/defineProperty"),t=require("three");function n(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var i=n(e);class a extends t.EventDispatcher{constructor(e){super(),i.default(this,"object",void 0),i.default(this,"changeEvent",{type:"change"}),i.default(this,"EPS",1e-6),i.default(this,"enabled",!0),i.default(this,"deviceOrientation",{alpha:0,beta:0,gamma:0}),i.default(this,"screenOrientation",0),i.default(this,"alphaOffset",0),i.default(this,"onDeviceOrientationChangeEvent",(e=>{this.deviceOrientation=e})),i.default(this,"onScreenOrientationChangeEvent",(()=>{this.screenOrientation=window.orientation||0})),i.default(this,"zee",new t.Vector3(0,0,1)),i.default(this,"euler",new t.Euler),i.default(this,"q0",new t.Quaternion),i.default(this,"q1",new t.Quaternion(-Math.sqrt(.5),0,0,Math.sqrt(.5))),i.default(this,"setObjectQuaternion",((e,t,n,i,a)=>{this.euler.set(n,t,-i,"YXZ"),e.setFromEuler(this.euler),e.multiply(this.q1),e.multiply(this.q0.setFromAxisAngle(this.zee,-a))})),i.default(this,"connect",(()=>{this.onScreenOrientationChangeEvent(),void 0!==window.DeviceOrientationEvent&&"function"==typeof window.DeviceOrientationEvent.requestPermission?window.DeviceOrientationEvent.requestPermission().then((e=>{"granted"==e&&(window.addEventListener("orientationchange",this.onScreenOrientationChangeEvent),window.addEventListener("deviceorientation",this.onDeviceOrientationChangeEvent))})).catch((e=>{console.error("THREE.DeviceOrientationControls: Unable to use DeviceOrientation API:",e)})):(window.addEventListener("orientationchange",this.onScreenOrientationChangeEvent),window.addEventListener("deviceorientation",this.onDeviceOrientationChangeEvent)),this.enabled=!0})),i.default(this,"disconnect",(()=>{window.removeEventListener("orientationchange",this.onScreenOrientationChangeEvent),window.removeEventListener("deviceorientation",this.onDeviceOrientationChangeEvent),this.enabled=!1})),i.default(this,"lastQuaternion",new t.Quaternion),i.default(this,"update",(()=>{if(!1===this.enabled)return;const e=this.deviceOrientation;if(e){const n=e.alpha?t.MathUtils.degToRad(e.alpha)+this.alphaOffset:0,i=e.beta?t.MathUtils.degToRad(e.beta):0,a=e.gamma?t.MathUtils.degToRad(e.gamma):0,o=this.screenOrientation?t.MathUtils.degToRad(this.screenOrientation):0;this.setObjectQuaternion(this.object.quaternion,n,i,a,o),8*(1-this.lastQuaternion.dot(this.object.quaternion))>this.EPS&&(this.lastQuaternion.copy(this.object.quaternion),this.dispatchEvent(this.changeEvent))}})),i.default(this,"dispose",(()=>this.disconnect())),this.object=e,this.object.rotation.reorder("YXZ"),this.connect()}}exports.DeviceOrientationControls=a;
