"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("three"),t=function(t){e.Loader.call(this,t)};t.prototype=Object.assign(Object.create(e.Loader.prototype),{constructor:t,load:function(t,i,s,r){var n=this,m=""===n.path?e.LoaderUtils.extractUrlBase(t):n.path,a=new e.FileLoader(n.manager);a.setPath(n.path),a.setResponseType("arraybuffer"),a.setRequestHeader(n.requestHeader),a.setWithCredentials(n.withCredentials),a.load(t,(function(e){try{i(n.parse(e,m))}catch(e){r?r(e):console.error(e),n.manager.itemError(t)}}),s,r)},parse:function(t,i){var s=new e.TextureLoader(this.manager);s.setPath(this.resourcePath||i).setCrossOrigin(this.crossOrigin);var r={KeyFrame:function(t,i){this.time=t,this.matrix=i.clone(),this.position=new e.Vector3,this.quaternion=new e.Quaternion,this.scale=new e.Vector3(1,1,1),this.matrix.decompose(this.position,this.quaternion,this.scale),this.clone=function(){return new r.KeyFrame(this.time,this.matrix)},this.lerp=function(e,t){var i=(t-=this.time)/(e.time-this.time),s=1-i,n=this.position,m=this.quaternion,a=e.position,o=e.quaternion;return r.KeyFrame.tempAniPos.x=n.x*s+a.x*i,r.KeyFrame.tempAniPos.y=n.y*s+a.y*i,r.KeyFrame.tempAniPos.z=n.z*s+a.z*i,r.KeyFrame.tempAniQuat.set(m.x,m.y,m.z,m.w),r.KeyFrame.tempAniQuat.slerp(o,i),r.KeyFrame.tempAniMatrix.compose(r.KeyFrame.tempAniPos,r.KeyFrame.tempAniQuat,r.KeyFrame.tempAniScale)}}};r.KeyFrame.tempAniPos=new e.Vector3,r.KeyFrame.tempAniQuat=new e.Quaternion,r.KeyFrame.tempAniScale=new e.Vector3(1,1,1),r.KeyFrame.tempAniMatrix=new e.Matrix4,r.KeyFrameTrack=function(){this.keys=[],this.target=null,this.time=0,this.length=0,this._accelTable={},this.fps=20,this.addKey=function(e){this.keys.push(e)},this.init=function(){if(this.sortKeys(),this.keys.length>0?this.length=this.keys[this.keys.length-1].time:this.length=0,this.fps)for(let e=0;e<this.length*this.fps;e++)for(let t=0;t<this.keys.length;t++){if(this.keys[t].time==e){this._accelTable[e]=t;break}if(this.keys[t].time<e/this.fps&&this.keys[t+1]&&this.keys[t+1].time>=e/this.fps){this._accelTable[e]=t;break}}},this.parseFromThree=function(e){var t=e.fps;this.target=e.node;var i=e.hierarchy[0].keys;for(let e=0;e<i.length;e++)this.addKey(new r.KeyFrame(e/t||i[e].time,i[e].targets[0].data));this.init()},this.parseFromCollada=function(e){var t=e.keys,i=this.fps;for(let e=0;e<t.length;e++)this.addKey(new r.KeyFrame(e/i||t[e].time,t[e].matrix));this.init()},this.sortKeys=function(){this.keys.sort(this.keySortFunc)},this.keySortFunc=function(e,t){return e.time-t.time},this.clone=function(){var e=new r.KeyFrameTrack;e.target=this.target,e.time=this.time,e.length=this.length;for(let t=0;t<this.keys.length;t++)e.addKey(this.keys[t].clone());return e.init(),e},this.reTarget=function(e,t){t||(t=r.TrackTargetNodeNameCompare),this.target=t(e,this.target)},this.keySearchAccel=function(e){return e*=this.fps,e=Math.floor(e),this._accelTable[e]||0},this.setTime=function(e){e=Math.abs(e),this.length&&(e=e%this.length+.05);var t=null,i=null;for(let s=this.keySearchAccel(e);s<this.keys.length;s++){if(this.keys[s].time==e){t=this.keys[s],i=this.keys[s];break}if(this.keys[s].time<e&&this.keys[s+1]&&this.keys[s+1].time>e){t=this.keys[s],i=this.keys[s+1];break}if(this.keys[s].time<e&&s==this.keys.length-1){t=this.keys[s],(i=this.keys[0].clone()).time+=this.length+.05;break}}return t&&i&&t!==i?(this.target.matrixAutoUpdate=!1,this.target.matrix.copy(t.lerp(i,e)),void(this.target.matrixWorldNeedsUpdate=!0)):t&&i&&t==i?(this.target.matrixAutoUpdate=!1,this.target.matrix.copy(t.matrix),void(this.target.matrixWorldNeedsUpdate=!0)):void 0}},r.TrackTargetNodeNameCompare=function(e,t){return function e(t,i){if(t.name==i)return t;for(let r=0;r<t.children.length;r++){var s=e(t.children[r],i);if(s)return s}return null}(e,t.name)},r.Animation=function(){this.tracks=[],this.length=0,this.addTrack=function(e){this.tracks.push(e),this.length=Math.max(e.length,this.length)},this.setTime=function(e){this.time=e;for(let t=0;t<this.tracks.length;t++)this.tracks[t].setTime(e)},this.clone=function(e,t){t||(t=r.TrackTargetNodeNameCompare);var i=new r.Animation;i.target=e;for(let r=0;r<this.tracks.length;r++){var s=this.tracks[r].clone();s.reTarget(e,t),i.addTrack(s)}return i}};function n(e){return 256<<e}function m(e){return 65536<<e}function a(t,i){var s=new e.Bone;s.matrix.copy(t.matrix),s.matrixWorld.copy(t.matrixWorld),s.position.copy(t.position),s.quaternion.copy(t.quaternion),s.scale.copy(t.scale),i.nodeCount++,s.name="bone_"+t.name+i.nodeCount.toString(),i.nodeToBoneMap[t.name]||(i.nodeToBoneMap[t.name]=[]),i.nodeToBoneMap[t.name].push(s);for(let e in t.children){var r=a(t.children[e],i);s.add(r)}return s}function o(e,t){var i=[];for(let s=0;s<e.length;s++)i.push({i:e[s],w:t[s]});for(i.sort((function(e,t){return t.w-e.w}));i.length<4;)i.push({i:0,w:0});i.length>4&&(i.length=4);var s=0;for(let e=0;e<4;e++)s+=i[e].w*i[e].w;s=Math.sqrt(s);for(let r=0;r<4;r++)i[r].w=i[r].w/s,e[r]=i[r].i,t[r]=i[r].w}function h(e,t){if(0==e.name.indexOf("bone_"+t))return e;for(let s in e.children){var i=h(e.children[s],t);if(i)return i}}function u(){this.mPrimitiveTypes=0,this.mNumVertices=0,this.mNumFaces=0,this.mNumBones=0,this.mMaterialIndex=0,this.mVertices=[],this.mNormals=[],this.mTangents=[],this.mBitangents=[],this.mColors=[[]],this.mTextureCoords=[[]],this.mFaces=[],this.mBones=[],this.hookupSkeletons=function(t){if(0!=this.mBones.length){for(var i=[],s=[],r=t.findNode(this.mBones[0].mName);r.mParent&&r.mParent.isBone;)r=r.mParent;var n=a(r.toTHREE(t),t);this.threeNode.add(n);for(let e=0;e<this.mBones.length;e++){if(o=h(n,this.mBones[e].mName)){var m=o;i.push(m),s.push(this.mBones[e].mOffsetMatrix.toTHREE())}else{if(!(r=t.findNode(this.mBones[e].mName)))return;n=a(r.toTHREE(t),t);this.threeNode.add(n);var o;m=o=h(n,this.mBones[e].mName);i.push(m),s.push(this.mBones[e].mOffsetMatrix.toTHREE())}}var u=new e.Skeleton(i,s);this.threeNode.bind(u,new e.Matrix4),this.threeNode.material.skinning=!0}},this.toTHREE=function(t){if(this.threeNode)return this.threeNode;var i,s,r=new e.BufferGeometry;if(i=t.mMaterials[this.mMaterialIndex]?t.mMaterials[this.mMaterialIndex].toTHREE(t):new e.MeshLambertMaterial,r.setIndex(new e.BufferAttribute(new Uint32Array(this.mIndexArray),1)),r.setAttribute("position",new e.BufferAttribute(this.mVertexBuffer,3)),this.mNormalBuffer&&this.mNormalBuffer.length>0&&r.setAttribute("normal",new e.BufferAttribute(this.mNormalBuffer,3)),this.mColorBuffer&&this.mColorBuffer.length>0&&r.setAttribute("color",new e.BufferAttribute(this.mColorBuffer,4)),this.mTexCoordsBuffers[0]&&this.mTexCoordsBuffers[0].length>0&&r.setAttribute("uv",new e.BufferAttribute(new Float32Array(this.mTexCoordsBuffers[0]),2)),this.mTexCoordsBuffers[1]&&this.mTexCoordsBuffers[1].length>0&&r.setAttribute("uv1",new e.BufferAttribute(new Float32Array(this.mTexCoordsBuffers[1]),2)),this.mTangentBuffer&&this.mTangentBuffer.length>0&&r.setAttribute("tangents",new e.BufferAttribute(this.mTangentBuffer,3)),this.mBitangentBuffer&&this.mBitangentBuffer.length>0&&r.setAttribute("bitangents",new e.BufferAttribute(this.mBitangentBuffer,3)),this.mBones.length>0){var n=[],m=[];for(let e=0;e<this.mBones.length;e++)for(let t=0;t<this.mBones[e].mWeights.length;t++){var a=this.mBones[e].mWeights[t];a&&(n[a.mVertexId]||(n[a.mVertexId]=[]),m[a.mVertexId]||(m[a.mVertexId]=[]),n[a.mVertexId].push(a.mWeight),m[a.mVertexId].push(parseInt(e)))}for(let e in m)o(m[e],n[e]);var h=[],u=[];for(let e=0;e<n.length;e++)for(let t=0;t<4;t++)n[e]&&m[e]?(h.push(n[e][t]),u.push(m[e][t])):(h.push(0),u.push(0));r.setAttribute("skinWeight",new e.BufferAttribute(new Float32Array(h),4)),r.setAttribute("skinIndex",new e.BufferAttribute(new Float32Array(u),4))}return 0==this.mBones.length&&(s=new e.Mesh(r,i)),this.mBones.length>0&&(s=new e.SkinnedMesh(r,i)).normalizeSkinWeights(),this.threeNode=s,s}}function f(){this.mNumIndices=0,this.mIndices=[]}function l(){this.x=0,this.y=0,this.z=0,this.toTHREE=function(){return new e.Vector3(this.x,this.y,this.z)}}function c(){this.r=0,this.g=0,this.b=0,this.a=0,this.toTHREE=function(){return new e.Color(this.r,this.g,this.b)}}function d(){this.x=0,this.y=0,this.z=0,this.w=0,this.toTHREE=function(){return new e.Quaternion(this.x,this.y,this.z,this.w)}}function p(){this.mVertexId=0,this.mWeight=0}function y(){this.data=[],this.toString=function(){var e="";return this.data.forEach((function(t){e+=String.fromCharCode(t)})),e.replace(/[^\x20-\x7E]+/g,"")}}function g(){this.mTime=0,this.mValue=null}function N(){this.mTime=0,this.mValue=null}function T(){this.mName="",this.mTransformation=[],this.mNumChildren=0,this.mNumMeshes=0,this.mMeshes=[],this.mChildren=[],this.toTHREE=function(t){if(this.threeNode)return this.threeNode;var i=new e.Object3D;i.name=this.mName,i.matrix=this.mTransformation.toTHREE();for(let e=0;e<this.mChildren.length;e++)i.add(this.mChildren[e].toTHREE(t));for(let e=0;e<this.mMeshes.length;e++)i.add(t.mMeshes[this.mMeshes[e]].toTHREE(t));return this.threeNode=i,i.matrix.decompose(i.position,i.quaternion,i.scale),i}}function A(){this.mName="",this.mNumWeights=0,this.mOffsetMatrix=0}function w(){this.mKey="",this.mSemantic=0,this.mIndex=0,this.mData=[],this.mDataLength=0,this.mType=0,this.dataAsColor=function(){var t=new Uint8Array(this.mData).buffer,i=new DataView(t),s=i.getFloat32(0,!0),r=i.getFloat32(4,!0),n=i.getFloat32(8,!0);return new e.Color(s,r,n)},this.dataAsFloat=function(){var e=new Uint8Array(this.mData).buffer;return new DataView(e).getFloat32(0,!0)},this.dataAsBool=function(){var e=new Uint8Array(this.mData).buffer;return!!new DataView(e).getFloat32(0,!0)},this.dataAsString=function(){var e=new y;return e.data=this.mData,e.toString()},this.dataAsMap=function(){var e=new y;e.data=this.mData;var t=e.toString();return-1!=(t=t.replace(/\\/g,"/")).indexOf("/")&&(t=t.substr(t.lastIndexOf("/")+1)),s.load(t)}}var v={"?mat.name":"name","$mat.shadingm":"shading","$mat.twosided":"twoSided","$mat.wireframe":"wireframe","$clr.ambient":"ambient","$clr.diffuse":"color","$clr.specular":"specular","$clr.emissive":"emissive","$clr.transparent":"transparent","$clr.reflective":"reflect","$mat.shininess":"shininess","$mat.reflectivity":"reflectivity","$mat.refracti":"refraction","$tex.file":"map"},x={"?mat.name":"string","$mat.shadingm":"bool","$mat.twosided":"bool","$mat.wireframe":"bool","$clr.ambient":"color","$clr.diffuse":"color","$clr.specular":"color","$clr.emissive":"color","$clr.transparent":"color","$clr.reflective":"color","$mat.shininess":"float","$mat.reflectivity":"float","$mat.refracti":"float","$tex.file":"map"};function B(){this.mNumAllocated=0,this.mNumProperties=0,this.mProperties=[],this.toTHREE=function(){var t=new e.MeshPhongMaterial;for(let e=0;e<this.mProperties.length;e++)if("float"==x[this.mProperties[e].mKey]&&(t[v[this.mProperties[e].mKey]]=this.mProperties[e].dataAsFloat()),"color"==x[this.mProperties[e].mKey]&&(t[v[this.mProperties[e].mKey]]=this.mProperties[e].dataAsColor()),"bool"==x[this.mProperties[e].mKey]&&(t[v[this.mProperties[e].mKey]]=this.mProperties[e].dataAsBool()),"string"==x[this.mProperties[e].mKey]&&(t[v[this.mProperties[e].mKey]]=this.mProperties[e].dataAsString()),"map"==x[this.mProperties[e].mKey]){var i=this.mProperties[e];1==i.mSemantic&&(t.map=this.mProperties[e].dataAsMap()),6==i.mSemantic&&(t.normalMap=this.mProperties[e].dataAsMap()),10==i.mSemantic&&(t.lightMap=this.mProperties[e].dataAsMap()),8==i.mSemantic&&(t.alphaMap=this.mProperties[e].dataAsMap())}return t.ambient.r=.53,t.ambient.g=.53,t.ambient.b=.53,t.color.r=1,t.color.g=1,t.color.b=1,t}}function C(t,i,s){var r=new e.Vector3,n=1-s;return r.x=t.x*s+i.x*n,r.y=t.y*s+i.y*n,r.z=t.z*s+i.z*n,r}function M(e,t,i){return e.clone().slerp(t,1-i)}function K(e,t,i,s){if(1==e.length)return e[0].mValue.toTHREE();var r=1/0,n=null,m=null;for(let i=0;i<e.length;i++){var a=Math.abs(e[i].mTime-t);a<r&&e[i].mTime<=t&&(r=a,n=e[i],m=e[i+1])}if(n){if(m){var o=m.mTime-n.mTime,h=(n.mTime-t)/o;return s(n.mValue.toTHREE(),m.mValue.toTHREE(),h)}(m=e[0].clone()).mTime+=i;o=m.mTime-n.mTime,h=(n.mTime-t)/o;return s(n.mValue.toTHREE(),m.mValue.toTHREE(),h)}return null}function k(){this.mNodeName="",this.mNumPositionKeys=0,this.mNumRotationKeys=0,this.mNumScalingKeys=0,this.mPositionKeys=[],this.mRotationKeys=[],this.mScalingKeys=[],this.mPreState="",this.mPostState="",this.init=function(e){function t(t){t.mTime/=e}e||(e=1),this.mPositionKeys.forEach(t),this.mRotationKeys.forEach(t),this.mScalingKeys.forEach(t)},this.sortKeys=function(){function e(e,t){return e.mTime-t.mTime}this.mPositionKeys.sort(e),this.mRotationKeys.sort(e),this.mScalingKeys.sort(e)},this.getLength=function(){return Math.max(Math.max.apply(null,this.mPositionKeys.map((function(e){return e.mTime}))),Math.max.apply(null,this.mRotationKeys.map((function(e){return e.mTime}))),Math.max.apply(null,this.mScalingKeys.map((function(e){return e.mTime}))))},this.toTHREE=function(t){this.sortKeys();var i=this.getLength(),s=new r.KeyFrameTrack;for(let t=0;t<i;t+=.05){var n=new e.Matrix4,m=t,a=K(this.mPositionKeys,m,i,C),o=K(this.mScalingKeys,m,i,C),h=K(this.mRotationKeys,m,i,M);n.compose(a,h,o);var u=new r.KeyFrame(m,n);s.addKey(u)}s.target=t.findNode(this.mNodeName).toTHREE();var f=[s];if(t.nodeToBoneMap[this.mNodeName])for(let e=0;e<t.nodeToBoneMap[this.mNodeName].length;e++){var l=s.clone();l.target=t.nodeToBoneMap[this.mNodeName][e],f.push(l)}return f}}function b(){this.mName="",this.mDuration=0,this.mTicksPerSecond=0,this.mNumChannels=0,this.mChannels=[],this.toTHREE=function(e){var t=new r.Animation;for(let s in this.mChannels){this.mChannels[s].init(this.mTicksPerSecond);var i=this.mChannels[s].toTHREE(e);for(let e in i)i[e].init(),t.addTrack(i[e])}return t.length=Math.max.apply(null,t.tracks.map((function(e){return e.length}))),t}}function P(){this.mWidth=0,this.mHeight=0,this.texAchFormatHint=[],this.pcData=[]}function E(){this.mName="",this.mType=0,this.mAttenuationConstant=0,this.mAttenuationLinear=0,this.mAttenuationQuadratic=0,this.mAngleInnerCone=0,this.mAngleOuterCone=0,this.mColorDiffuse=null,this.mColorSpecular=null,this.mColorAmbient=null}function S(){this.mName="",this.mPosition=null,this.mLookAt=null,this.mUp=null,this.mHorizontalFOV=0,this.mClipPlaneNear=0,this.mClipPlaneFar=0,this.mAspect=0}function F(){this.versionMajor=0,this.versionMinor=0,this.versionRevision=0,this.compileFlags=0,this.mFlags=0,this.mNumMeshes=0,this.mNumMaterials=0,this.mNumAnimations=0,this.mNumTextures=0,this.mNumLights=0,this.mNumCameras=0,this.mRootNode=null,this.mMeshes=[],this.mMaterials=[],this.mAnimations=[],this.mLights=[],this.mCameras=[],this.nodeToBoneMap={},this.findNode=function(e,t){if(t||(t=this.mRootNode),t.mName==e)return t;for(let s=0;s<t.mChildren.length;s++){var i=this.findNode(e,t.mChildren[s]);if(i)return i}return null},this.toTHREE=function(){this.nodeCount=0,function(e){for(let s in e.mMeshes){var t=e.mMeshes[s];for(let s in t.mBones){var i=e.findNode(t.mBones[s].mName);i&&(i.isBone=!0)}}}(this);var e=this.mRootNode.toTHREE(this);for(let e in this.mMeshes)this.mMeshes[e].hookupSkeletons(this);if(this.mAnimations.length>0)var t=this.mAnimations[0].toTHREE(this);return{object:e,animation:t}}}function R(){this.elements=[[],[],[],[]],this.toTHREE=function(){var t=new e.Matrix4;for(let e=0;e<4;++e)for(let i=0;i<4;++i)t.elements[4*e+i]=this.elements[i][e];return t}}var V=!0;function I(e){var t=e.getFloat32(e.readOffset,V);return e.readOffset+=4,t}function O(e){var t=e.getFloat64(e.readOffset,V);return e.readOffset+=8,t}function H(e){var t=e.getUint16(e.readOffset,V);return e.readOffset+=2,t}function D(e){var t=e.getUint32(e.readOffset,V);return e.readOffset+=4,t}function $(e){var t=e.getUint32(e.readOffset,V);return e.readOffset+=4,t}function U(e){var t=new l;return t.x=I(e),t.y=I(e),t.z=I(e),t}function L(e){var t=new c;return t.r=I(e),t.g=I(e),t.b=I(e),t}function W(e){var t=new y,i=D(e);return e.ReadBytes(t.data,1,i),t.toString()}function z(e){var t=new p;return t.mVertexId=D(e),t.mWeight=I(e),t}function q(e){var t=new R;for(let i=0;i<4;++i)for(let s=0;s<4;++s)t.elements[i][s]=I(e);return t}function Q(e){var t=new g;return t.mTime=O(e),t.mValue=U(e),t}function _(e){var t=new N;return t.mTime=O(e),t.mValue=function(e){var t=new d;return t.w=I(e),t.x=I(e),t.y=I(e),t.z=I(e),t}(e),t}function j(e,t,i){for(let s=0;s<i;s++)t[s]=Q(e)}function G(e,t,i){return e.Seek(sizeof(t)*i,ue)}function J(e){if(!e)throw"asset failed"}function X(e,t,i){J(4668==$(e)),$(e);var s=new T;if(s.mParent=t,s.mDepth=i,s.mName=W(e),s.mTransformation=q(e),s.mNumChildren=D(e),s.mNumMeshes=D(e),s.mNumMeshes){s.mMeshes=[];for(let t=0;t<s.mNumMeshes;++t)s.mMeshes[t]=D(e)}if(s.mNumChildren){s.mChildren=[];for(let t=0;t<s.mNumChildren;++t){var r=X(e,s,i++);s.mChildren[t]=r}}return s}function Y(e,t){return J(4666==$(e)),$(e),t.mName=W(e),t.mNumWeights=D(e),t.mOffsetMatrix=q(e),oe?G(e,t.mWeights,t.mNumWeights):(t.mWeights=[],function(e,t,i){for(let s=0;s<i;s++)t[s]=z(e)}(e,t.mWeights,t.mNumWeights)),t}function Z(e,t){J(4663==$(e)),$(e),t.mPrimitiveTypes=D(e),t.mNumVertices=D(e),t.mNumFaces=D(e),t.mNumBones=D(e),t.mMaterialIndex=D(e),t.mNumUVComponents=[];var i=D(e);1&i&&(oe?G(e,t.mVertices,t.mNumVertices):(t.mVertices=[],t.mVertexBuffer=e.subArray32(e.readOffset,e.readOffset+3*t.mNumVertices*4),e.Seek(3*t.mNumVertices*4,ue))),2&i&&(oe?G(e,t.mNormals,t.mNumVertices):(t.mNormals=[],t.mNormalBuffer=e.subArray32(e.readOffset,e.readOffset+3*t.mNumVertices*4),e.Seek(3*t.mNumVertices*4,ue))),4&i&&(oe?(G(e,t.mTangents,t.mNumVertices),G(e,t.mBitangents,t.mNumVertices)):(t.mTangents=[],t.mTangentBuffer=e.subArray32(e.readOffset,e.readOffset+3*t.mNumVertices*4),e.Seek(3*t.mNumVertices*4,ue),t.mBitangents=[],t.mBitangentBuffer=e.subArray32(e.readOffset,e.readOffset+3*t.mNumVertices*4),e.Seek(3*t.mNumVertices*4,ue)));for(let s=0;s<1&&i&m(s);++s)oe?G(e,t.mColors[s],t.mNumVertices):(t.mColors[s]=[],t.mColorBuffer=e.subArray32(e.readOffset,e.readOffset+4*t.mNumVertices*4),e.Seek(4*t.mNumVertices*4,ue));t.mTexCoordsBuffers=[];for(let s=0;s<4&&i&n(s);++s)if(t.mNumUVComponents[s]=D(e),oe)G(e,t.mTextureCoords[s],t.mNumVertices);else{t.mTextureCoords[s]=[],t.mTexCoordsBuffers[s]=[];for(let i=0;i<t.mNumVertices;i++)t.mTexCoordsBuffers[s].push(I(e)),t.mTexCoordsBuffers[s].push(I(e)),I(e)}if(oe)D(e);else{t.mFaces=[],t.mIndexArray=[];for(let i=0;i<t.mNumFaces;++i){var s=t.mFaces[i]=new f;s.mNumIndices=H(e),s.mIndices=[];for(let i=0;i<s.mNumIndices;++i)t.mNumVertices<65536?s.mIndices[i]=H(e):s.mIndices[i]=D(e);if(3===s.mNumIndices)t.mIndexArray.push(s.mIndices[0]),t.mIndexArray.push(s.mIndices[1]),t.mIndexArray.push(s.mIndices[2]);else{if(4!==s.mNumIndices)throw new Error("Sorry, can't currently triangulate polys. Use the triangulate preprocessor in Assimp.");t.mIndexArray.push(s.mIndices[0]),t.mIndexArray.push(s.mIndices[1]),t.mIndexArray.push(s.mIndices[2]),t.mIndexArray.push(s.mIndices[2]),t.mIndexArray.push(s.mIndices[3]),t.mIndexArray.push(s.mIndices[0])}}}if(t.mNumBones){t.mBones=[];for(let i=0;i<t.mNumBones;++i)t.mBones[i]=new A,Y(e,t.mBones[i])}}function ee(e,t){J(4670==$(e)),$(e),t.mKey=W(e),t.mSemantic=D(e),t.mIndex=D(e),t.mDataLength=D(e),t.mType=D(e),t.mData=[],e.ReadBytes(t.mData,1,t.mDataLength)}function te(e,t){if(J(4669==$(e)),$(e),t.mNumAllocated=t.mNumProperties=D(e),t.mNumProperties){t.mProperties&&delete t.mProperties,t.mProperties=[];for(let i=0;i<t.mNumProperties;++i)t.mProperties[i]=new w,ee(e,t.mProperties[i])}}function ie(e,t){J(4664==$(e)),$(e),t.mNodeName=W(e),t.mNumPositionKeys=D(e),t.mNumRotationKeys=D(e),t.mNumScalingKeys=D(e),t.mPreState=D(e),t.mPostState=D(e),t.mNumPositionKeys&&(oe?G(e,t.mPositionKeys,t.mNumPositionKeys):(t.mPositionKeys=[],j(e,t.mPositionKeys,t.mNumPositionKeys))),t.mNumRotationKeys&&(oe?G(e,t.mRotationKeys,t.mNumRotationKeys):(t.mRotationKeys=[],function(e,t,i){for(let s=0;s<i;s++)t[s]=_(e)}(e,t.mRotationKeys,t.mNumRotationKeys))),t.mNumScalingKeys&&(oe?G(e,t.mScalingKeys,t.mNumScalingKeys):(t.mScalingKeys=[],j(e,t.mScalingKeys,t.mNumScalingKeys)))}function se(e,t){if(J(4667==$(e)),$(e),t.mName=W(e),t.mDuration=O(e),t.mTicksPerSecond=O(e),t.mNumChannels=D(e),t.mNumChannels){t.mChannels=[];for(let i=0;i<t.mNumChannels;++i)t.mChannels[i]=new k,ie(e,t.mChannels[i])}}function re(e,t){J(4662==$(e)),$(e),t.mWidth=D(e),t.mHeight=D(e),e.ReadBytes(t.achFormatHint,1,4),oe||(t.mHeight?(t.pcData=[],e.ReadBytes(t.pcData,1,t.mWidth*t.mHeight*4)):(t.pcData=[],e.ReadBytes(t.pcData,1,t.mWidth)))}function ne(e,t){J(4661==$(e)),$(e),t.mName=W(e),t.mType=D(e),1!=t.mType&&(t.mAttenuationConstant=I(e),t.mAttenuationLinear=I(e),t.mAttenuationQuadratic=I(e)),t.mColorDiffuse=L(e),t.mColorSpecular=L(e),t.mColorAmbient=L(e),3==t.mType&&(t.mAngleInnerCone=I(e),t.mAngleOuterCone=I(e))}function me(e,t){J(4660==$(e)),$(e),t.mName=W(e),t.mPosition=U(e),t.mLookAt=U(e),t.mUp=U(e),t.mHorizontalFOV=I(e),t.mClipPlaneNear=I(e),t.mClipPlaneFar=I(e),t.mAspect=I(e)}function ae(e,t){if(J(4665==$(e)),$(e),t.mFlags=D(e),t.mNumMeshes=D(e),t.mNumMaterials=D(e),t.mNumAnimations=D(e),t.mNumTextures=D(e),t.mNumLights=D(e),t.mNumCameras=D(e),t.mRootNode=new T,t.mRootNode=X(e,null,0),t.mNumMeshes){t.mMeshes=[];for(let i=0;i<t.mNumMeshes;++i)t.mMeshes[i]=new u,Z(e,t.mMeshes[i])}if(t.mNumMaterials){t.mMaterials=[];for(let i=0;i<t.mNumMaterials;++i)t.mMaterials[i]=new B,te(e,t.mMaterials[i])}if(t.mNumAnimations){t.mAnimations=[];for(let i=0;i<t.mNumAnimations;++i)t.mAnimations[i]=new b,se(e,t.mAnimations[i])}if(t.mNumTextures){t.mTextures=[];for(let i=0;i<t.mNumTextures;++i)t.mTextures[i]=new P,re(e,t.mTextures[i])}if(t.mNumLights){t.mLights=[];for(let i=0;i<t.mNumLights;++i)t.mLights[i]=new E,ne(e,t.mLights[i])}if(t.mNumCameras){t.mCameras=[];for(let i=0;i<t.mNumCameras;++i)t.mCameras[i]=new S,me(e,t.mCameras[i])}}var oe,he,ue=0;return function(e){var t=new F,i=new DataView(e);if(function(e){e.readOffset=0,e.Seek=function(t,i){i==ue&&(e.readOffset+=t),1==i&&(e.readOffset=t)},e.ReadBytes=function(e,t,i){var s,r,n=t*i;for(let t=0;t<n;t++)e[t]=(r=void 0,r=(s=this).getUint8(s.readOffset),s.readOffset+=1,r)},e.subArray32=function(e,t){var i=this.buffer.slice(e,t);return new Float32Array(i)},e.subArrayUint16=function(e,t){var i=this.buffer.slice(e,t);return new Uint16Array(i)},e.subArrayUint8=function(e,t){var i=this.buffer.slice(e,t);return new Uint8Array(i)},e.subArrayUint32=function(e,t){var i=this.buffer.slice(e,t);return new Uint32Array(i)}}(i),i.Seek(44,ue),t.versionMajor=D(i),t.versionMinor=D(i),t.versionRevision=D(i),t.compileFlags=D(i),oe=H(i)>0,he=H(i)>0,oe)throw"Shortened binaries are not supported!";if(i.Seek(256,ue),i.Seek(128,ue),i.Seek(64,ue),he){var s=$(i),r=i.FileSize()-i.Tell(),n=[];i.Read(n,1,r);var m=[];uncompress(m,s,n,r),ae(new ArrayBuffer(m),t)}else ae(i,t);return t.toTHREE()}(t)}}),exports.AssimpLoader=t;
