"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("three"),r=require("./ColladaLoader.cjs.js"),t=require("fflate");require("./TGALoader.cjs.js");class o extends e.Loader{constructor(e){super(e)}load(r,t,o,a){const n=this,s=new e.FileLoader(n.manager);s.setPath(n.path),s.setResponseType("arraybuffer"),s.setRequestHeader(n.requestHeader),s.setWithCredentials(n.withCredentials),s.load(r,(function(e){try{t(n.parse(e))}catch(e){a?a(e):console.error(e),n.manager.itemError(r)}}),o,a)}parse(o){const a=new e.LoadingManager;a.setURLModifier((function(e){const r=function(e){for(const r in n)if(r.substr(-e.length)===e)return n[r]}(e);if(r){console.log("Loading",e);const t=new Blob([r.buffer],{type:"application/octet-stream"});return URL.createObjectURL(t)}return e}));const n=t.unzipSync(new Uint8Array(o));if(n["doc.kml"]){const e=(new DOMParser).parseFromString(fflate.strFromU8(n["doc.kml"]),"application/xml").querySelector("Placemark Model Link href");if(e){return new r.ColladaLoader(a).parse(fflate.strFromU8(n[e.textContent]))}}else{console.warn("KMZLoader: Missing doc.kml file.");for(const e in n){if("dae"===e.split(".").pop().toLowerCase()){return new r.ColladaLoader(a).parse(fflate.strFromU8(n[e]))}}}return console.error("KMZLoader: Couldn't find .dae file."),{scene:new e.Group}}}exports.KMZLoader=o;
