"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("three");class r extends e.CompressedTextureLoader{constructor(e){super(e)}parse(r,t){const a={mipmaps:[],width:0,height:0,format:null,mipmapCount:1};function o(e){return e.charCodeAt(0)+(e.charCodeAt(1)<<8)+(e.charCodeAt(2)<<16)+(e.charCodeAt(3)<<24)}function n(e,r,t,a){const o=t*a*4,n=new Uint8Array(e,r,o),s=new Uint8Array(o);let m=0,c=0;for(let e=0;e<a;e++)for(let e=0;e<t;e++){const e=n[c];c++;const r=n[c];c++;const t=n[c];c++;const a=n[c];c++,s[m]=t,m++,s[m]=r,m++,s[m]=e,m++,s[m]=a,m++}return s}const s=o("DXT1"),m=o("DXT3"),c=o("DXT5"),i=o("ETC1"),u=new Int32Array(r,0,31);if(542327876!==u[0])return console.error("THREE.DDSLoader.parse: Invalid magic number in DDS header."),a;if(4&!u[20])return console.error("THREE.DDSLoader.parse: Unsupported format, must contain a FourCC code."),a;let p;const d=u[21];let h=!1;switch(d){case s:p=8,a.format=e.RGB_S3TC_DXT1_Format;break;case m:p=16,a.format=e.RGBA_S3TC_DXT3_Format;break;case c:p=16,a.format=e.RGBA_S3TC_DXT5_Format;break;case i:p=8,a.format=e.RGB_ETC1_Format;break;default:if(!(32===u[22]&&16711680&u[23]&&65280&u[24]&&255&u[25]&&4278190080&u[26]))return console.error("THREE.DDSLoader.parse: Unsupported FourCC code ",(l=d,String.fromCharCode(255&l,l>>8&255,l>>16&255,l>>24&255))),a;h=!0,p=64,a.format=e.RGBAFormat}var l;a.mipmapCount=1,131072&u[2]&&!1!==t&&(a.mipmapCount=Math.max(1,u[7]));const C=u[28];if(a.isCubemap=!!(512&C),a.isCubemap&&(!(1024&C)||!(2048&C)||!(4096&C)||!(8192&C)||!(16384&C)||!(32768&C)))return console.error("THREE.DDSLoader.parse: Incomplete cubemap faces"),a;a.width=u[4],a.height=u[3];let f=u[1]+4;const D=a.isCubemap?6:1;for(let e=0;e<D;e++){let e=a.width,t=a.height;for(let o=0;o<a.mipmapCount;o++){let o,s;h?(o=n(r,f,e,t),s=o.length):(s=Math.max(4,e)/4*Math.max(4,t)/4*p,o=new Uint8Array(r,f,s));const m={data:o,width:e,height:t};a.mipmaps.push(m),f+=s,e=Math.max(e>>1,1),t=Math.max(t>>1,1)}}return a}}exports.DDSLoader=r;
