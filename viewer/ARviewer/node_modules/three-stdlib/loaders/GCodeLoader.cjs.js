"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("three");class t extends e.Loader{constructor(e){super(e),this.splitLayer=!1}load(t,r,i,n){const o=this,l=new e.FileLoader(o.manager);l.setPath(o.path),l.setRequestHeader(o.requestHeader),l.setWithCredentials(o.withCredentials),l.load(t,(function(e){try{r(o.parse(e))}catch(e){n?n(e):console.error(e),o.manager.itemError(t)}}),i,n)}parse(t){let r,i={x:0,y:0,z:0,e:0,f:0,extruding:!1,relative:!1},n=[];const o=new e.LineBasicMaterial({color:16711680});o.name="path";const l=new e.LineBasicMaterial({color:65280});function a(e){r={vertex:[],pathVertex:[],z:e.z},n.push(r)}function s(e,t){return i.relative?t:t-e}function u(e,t){return i.relative?e+t:t}l.name="extruded";let d=t.replace(/;.+/g,"").split("\n");for(let e=0;e<d.length;e++){let t=d[e].split(" "),n=t[0].toUpperCase(),o={};if(t.splice(1).forEach((function(e){if(void 0!==e[0]){let t=e[0].toLowerCase(),r=parseFloat(e.substring(1));o[t]=r}})),"G0"===n||"G1"===n){let e={x:void 0!==o.x?u(i.x,o.x):i.x,y:void 0!==o.y?u(i.y,o.y):i.y,z:void 0!==o.z?u(i.z,o.z):i.z,e:void 0!==o.e?u(i.e,o.e):i.e,f:void 0!==o.f?u(i.f,o.f):i.f};s(i.e,e.e)>0&&(e.extruding=s(i.e,e.e)>0,null!=r&&e.z==r.z||a(e)),h=i,p=e,void 0===r&&a(h),i.extruding?(r.vertex.push(h.x,h.y,h.z),r.vertex.push(p.x,p.y,p.z)):(r.pathVertex.push(h.x,h.y,h.z),r.pathVertex.push(p.x,p.y,p.z)),i=e}else if("G2"===n||"G3"===n);else if("G90"===n)i.relative=!1;else if("G91"===n)i.relative=!0;else if("G92"===n){let e=i;e.x=void 0!==o.x?o.x:e.x,e.y=void 0!==o.y?o.y:e.y,e.z=void 0!==o.z?o.z:e.z,e.e=void 0!==o.e?o.e:e.e,i=e}}var h,p;function x(t,r,i){let n=new e.BufferGeometry;n.setAttribute("position",new e.Float32BufferAttribute(t,3));let a=new e.LineSegments(n,r?l:o);a.name="layer"+i,f.add(a)}const f=new e.Group;if(f.name="gcode",this.splitLayer)for(let e=0;e<n.length;e++){let t=n[e];x(t.vertex,!0,e),x(t.pathVertex,!1,e)}else{const e=[],t=[];for(let r=0;r<n.length;r++){let i=n[r],o=i.vertex,l=i.pathVertex;for(let t=0;t<o.length;t++)e.push(o[t]);for(let e=0;e<l.length;e++)t.push(l[e])}x(e,!0,n.length),x(t,!1,n.length)}return f.quaternion.setFromEuler(new e.Euler(-Math.PI/2,0,0)),f}}exports.GCodeLoader=t;
