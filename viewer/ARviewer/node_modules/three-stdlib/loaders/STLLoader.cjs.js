"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var t=require("three");class e extends t.Loader{constructor(t){super(t)}load(e,r,n,o){const s=this,a=new t.FileLoader(this.manager);a.setPath(this.path),a.setResponseType("arraybuffer"),a.setRequestHeader(this.requestHeader),a.setWithCredentials(this.withCredentials),a.load(e,(function(t){try{r(s.parse(t))}catch(t){o?o(t):console.error(t),s.manager.itemError(e)}}),n,o)}parse(e){function r(t,e,r){for(let n=0,o=t.length;n<o;n++)if(t[n]!==e.getUint8(r+n,!1))return!1;return!0}const n=function(t){if("string"==typeof t){const e=new Uint8Array(t.length);for(let r=0;r<t.length;r++)e[r]=255&t.charCodeAt(r);return e.buffer||e}return t}(e);return function(t){const e=new DataView(t);if(84+50*e.getUint32(80,!0)===e.byteLength)return!0;const n=[115,111,108,105,100];for(let t=0;t<5;t++)if(r(n,e,t))return!1;return!0}(n)?function(e){const r=new DataView(e),n=r.getUint32(80,!0);let o,s,a,i,l,u,f,c,g=!1;for(let t=0;t<70;t++)1129270351==r.getUint32(t,!1)&&82==r.getUint8(t+4)&&61==r.getUint8(t+5)&&(g=!0,i=new Float32Array(3*n*3),l=r.getUint8(t+6)/255,u=r.getUint8(t+7)/255,f=r.getUint8(t+8)/255,c=r.getUint8(t+9)/255);const h=new t.BufferGeometry,d=new Float32Array(3*n*3),p=new Float32Array(3*n*3);for(let t=0;t<n;t++){const e=84+50*t,n=r.getFloat32(e,!0),c=r.getFloat32(e+4,!0),h=r.getFloat32(e+8,!0);if(g){const t=r.getUint16(e+48,!0);0==(32768&t)?(o=(31&t)/31,s=(t>>5&31)/31,a=(t>>10&31)/31):(o=l,s=u,a=f)}for(let l=1;l<=3;l++){const u=e+12*l,f=3*t*3+3*(l-1);d[f]=r.getFloat32(u,!0),d[f+1]=r.getFloat32(u+4,!0),d[f+2]=r.getFloat32(u+8,!0),p[f]=n,p[f+1]=c,p[f+2]=h,g&&(i[f]=o,i[f+1]=s,i[f+2]=a)}}return h.setAttribute("position",new t.BufferAttribute(d,3)),h.setAttribute("normal",new t.BufferAttribute(p,3)),g&&(h.setAttribute("color",new t.BufferAttribute(i,3)),h.hasColors=!0,h.alpha=c),h}(n):function(e){const r=new t.BufferGeometry,n=/solid([\s\S]*?)endsolid/g,o=/facet([\s\S]*?)endfacet/g;let s=0;const a=/[\s]+([+-]?(?:\d*)(?:\.\d*)?(?:[eE][+-]?\d+)?)/.source,i=new RegExp("vertex"+a+a+a,"g"),l=new RegExp("normal"+a+a+a,"g"),u=[],f=[],c=new t.Vector3;let g,h=0,d=0,p=0;for(;null!==(g=n.exec(e));){d=p;const t=g[0];for(;null!==(g=o.exec(t));){let t=0,e=0;const r=g[0];for(;null!==(g=l.exec(r));)c.x=parseFloat(g[1]),c.y=parseFloat(g[2]),c.z=parseFloat(g[3]),e++;for(;null!==(g=i.exec(r));)u.push(parseFloat(g[1]),parseFloat(g[2]),parseFloat(g[3])),f.push(c.x,c.y,c.z),t++,p++;1!==e&&console.error("THREE.STLLoader: Something isn't right with the normal of face number "+s),3!==t&&console.error("THREE.STLLoader: Something isn't right with the vertices of face number "+s),s++}const e=d,n=p-d;r.addGroup(e,n,h),h++}return r.setAttribute("position",new t.Float32BufferAttribute(u,3)),r.setAttribute("normal",new t.Float32BufferAttribute(f,3)),r}("string"!=typeof(o=e)?t.LoaderUtils.decodeText(new Uint8Array(o)):o);var o}}exports.STLLoader=e;
