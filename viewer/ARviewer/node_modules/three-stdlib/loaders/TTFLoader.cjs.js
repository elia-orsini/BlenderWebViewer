"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("three"),t=require("opentype.js");class o extends e.Loader{constructor(e){super(e),this.reversed=!1}load(o,n,s,r){const a=this,i=new e.FileLoader(this.manager);i.setPath(this.path),i.setResponseType("arraybuffer"),i.setRequestHeader(this.requestHeader),i.setWithCredentials(this.withCredentials),i.load(o,(function(e){try{n(t.parse(e))}catch(e){r?r(e):console.error(e),a.manager.itemError(o)}}),s,r)}parse(e){function o(e){const t=[];let o;e.forEach((function(e){"m"===e.type.toLowerCase()?(o=[e],t.push(o)):"z"!==e.type.toLowerCase()&&o.push(e)}));const n=[];return t.forEach((function(e){const t={type:"m",x:e[e.length-1].x,y:e[e.length-1].y};n.push(t);for(let t=e.length-1;t>0;t--){const o=e[t],s={type:o.type};void 0!==o.x2&&void 0!==o.y2?(s.x1=o.x2,s.y1=o.y2,s.x2=o.x1,s.y2=o.y1):void 0!==o.x1&&void 0!==o.y1&&(s.x1=o.x1,s.y1=o.y1),s.x=e[t-1].x,s.y=e[t-1].y,n.push(s)}})),n}return function(e,t){const n=Math.round,s={},r=1e5/(72*(e.unitsPerEm||2048)),a=e.encoding.cmap.glyphIndexMap,i=Object.keys(a);for(let d=0;d<i.length;d++){const h=i[d],y=e.glyphs.glyphs[a[h]];if(void 0!==h){const e={ha:n(y.advanceWidth*r),x_min:n(y.xMin*r),x_max:n(y.xMax*r),o:""};t&&(y.path.commands=o(y.path.commands)),y.path.commands.forEach((function(t){"c"===t.type.toLowerCase()&&(t.type="b"),e.o+=t.type.toLowerCase()+" ",void 0!==t.x&&void 0!==t.y&&(e.o+=n(t.x*r)+" "+n(t.y*r)+" "),void 0!==t.x1&&void 0!==t.y1&&(e.o+=n(t.x1*r)+" "+n(t.y1*r)+" "),void 0!==t.x2&&void 0!==t.y2&&(e.o+=n(t.x2*r)+" "+n(t.y2*r)+" ")})),s[String.fromCodePoint(y.unicode)]=e}}return{glyphs:s,familyName:e.getEnglishName("fullName"),ascender:n(e.ascender*r),descender:n(e.descender*r),underlinePosition:e.tables.post.underlinePosition,underlineThickness:e.tables.post.underlineThickness,boundingBox:{xMin:e.tables.head.xMin,xMax:e.tables.head.xMax,yMin:e.tables.head.yMin,yMax:e.tables.head.yMax},resolution:1e3,original_font_information:e.tables.name}}(t.parse(e),this.reversed)}}exports.TTFLoader=o;
