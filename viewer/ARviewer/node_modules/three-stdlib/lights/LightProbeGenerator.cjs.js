"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("three"),r={fromCubeTexture:function(r){var a,n,o,s=0,c=new e.Vector3,i=new e.Vector3,h=new e.Color,l=[0,0,0,0,0,0,0,0,0],g=new e.SphericalHarmonics3,b=g.coefficients;for(let a=0;a<6;a++){var d=r.image[a],f=d.width,w=d.height,u=document.createElement("canvas");u.width=f,u.height=w;var v=u.getContext("2d");v.drawImage(d,0,0,f,w);var m=v.getImageData(0,0,f,w),k=m.data,p=m.width,x=2/p;for(let g=0,d=k.length;g<d;g+=4){h.setRGB(k[g]/255,k[g+1]/255,k[g+2]/255),t(h,r.encoding);var y=g/4,P=(y%p+.5)*x-1,G=1-(Math.floor(y/p)+.5)*x;switch(a){case 0:c.set(-1,G,-P);break;case 1:c.set(1,G,P);break;case 2:c.set(-P,1,-G);break;case 3:c.set(-P,-1,G);break;case 4:c.set(-P,G,1);break;case 5:c.set(P,G,-1)}n=c.lengthSq(),s+=o=4/(Math.sqrt(n)*n),i.copy(c).normalize(),e.SphericalHarmonics3.getBasisAt(i,l);for(let e=0;e<9;e++)b[e].x+=l[e]*h.r*o,b[e].y+=l[e]*h.g*o,b[e].z+=l[e]*h.b*o}}a=4*Math.PI/s;for(let e=0;e<9;e++)b[e].x*=a,b[e].y*=a,b[e].z*=a;return new e.LightProbe(g)},fromCubeRenderTarget:function(r,a){var n,o,s,c=0,i=new e.Vector3,h=new e.Vector3,l=new e.Color,g=[0,0,0,0,0,0,0,0,0],b=new e.SphericalHarmonics3,d=b.coefficients;for(let n=0;n<6;n++){var f=a.width,w=new Uint8Array(f*f*4);r.readRenderTargetPixels(a,0,0,f,f,w,n);var u=2/f;for(let r=0,b=w.length;r<b;r+=4){l.setRGB(w[r]/255,w[r+1]/255,w[r+2]/255),t(l,a.texture.encoding);var v=r/4,m=(v%f+.5)*u-1,k=1-(Math.floor(v/f)+.5)*u;switch(n){case 0:i.set(1,k,-m);break;case 1:i.set(-1,k,m);break;case 2:i.set(m,1,-k);break;case 3:i.set(m,-1,k);break;case 4:i.set(m,k,1);break;case 5:i.set(-m,k,-1)}o=i.lengthSq(),c+=s=4/(Math.sqrt(o)*o),h.copy(i).normalize(),e.SphericalHarmonics3.getBasisAt(h,g);for(let e=0;e<9;e++)d[e].x+=g[e]*l.r*s,d[e].y+=g[e]*l.g*s,d[e].z+=g[e]*l.b*s}}n=4*Math.PI/c;for(let e=0;e<9;e++)d[e].x*=n,d[e].y*=n,d[e].z*=n;return new e.LightProbe(b)}},t=function(r,t){switch(t){case e.sRGBEncoding:r.convertSRGBToLinear();break;case e.LinearEncoding:break;default:console.warn("WARNING: LightProbeGenerator convertColorToLinear() encountered an unsupported encoding.")}return r};exports.LightProbeGenerator=r;
