"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var t=require("three"),e={c:null,u:[new t.Vector3,new t.Vector3,new t.Vector3],e:[]},i={c:null,u:[new t.Vector3,new t.Vector3,new t.Vector3],e:[]},n=[[],[],[]],r=[[],[],[]],a=[],s=new t.Vector3,o=new t.Vector3,h=new t.Vector3,c=new t.Vector3,l=new t.Vector3,u=new t.Vector3,f=new t.Matrix3,S=new t.Box3,z=new t.Matrix4,m=new t.Matrix4,p=new t.Ray;function y(e=new t.Vector3,i=new t.Vector3,n=new t.Matrix3){this.center=e,this.halfSize=i,this.rotation=n}Object.assign(y.prototype,{set:function(t,e,i){return this.center=t,this.halfSize=e,this.rotation=i,this},copy:function(t){return this.center.copy(t.center),this.halfSize.copy(t.halfSize),this.rotation.copy(t.rotation),this},clone:function(){return(new this.constructor).copy(this)},getSize:function(t){return t.copy(this.halfSize).multiplyScalar(2)},clampPoint:function(e,i){var n=this.halfSize;c.subVectors(e,this.center),this.rotation.extractBasis(s,o,h),i.copy(this.center);var r=t.MathUtils.clamp(c.dot(s),-n.x,n.x);i.add(s.multiplyScalar(r));var a=t.MathUtils.clamp(c.dot(o),-n.y,n.y);i.add(o.multiplyScalar(a));var l=t.MathUtils.clamp(c.dot(h),-n.z,n.z);return i.add(h.multiplyScalar(l)),i},containsPoint:function(t){return c.subVectors(t,this.center),this.rotation.extractBasis(s,o,h),Math.abs(c.dot(s))<=this.halfSize.x&&Math.abs(c.dot(o))<=this.halfSize.y&&Math.abs(c.dot(h))<=this.halfSize.z},intersectsBox3:function(t){return this.intersectsOBB(M.fromBox3(t))},intersectsSphere:function(t){return this.clampPoint(t.center,u),u.distanceToSquared(t.center)<=t.radius*t.radius},intersectsOBB:function(t,s=Number.EPSILON){e.c=this.center,e.e[0]=this.halfSize.x,e.e[1]=this.halfSize.y,e.e[2]=this.halfSize.z,this.rotation.extractBasis(e.u[0],e.u[1],e.u[2]),i.c=t.center,i.e[0]=t.halfSize.x,i.e[1]=t.halfSize.y,i.e[2]=t.halfSize.z,t.rotation.extractBasis(i.u[0],i.u[1],i.u[2]);for(let t=0;t<3;t++)for(let r=0;r<3;r++)n[t][r]=e.u[t].dot(i.u[r]);c.subVectors(i.c,e.c),a[0]=c.dot(e.u[0]),a[1]=c.dot(e.u[1]),a[2]=c.dot(e.u[2]);for(let t=0;t<3;t++)for(let e=0;e<3;e++)r[t][e]=Math.abs(n[t][e])+s;var o,h;for(let t=0;t<3;t++)if(o=e.e[t],h=i.e[0]*r[t][0]+i.e[1]*r[t][1]+i.e[2]*r[t][2],Math.abs(a[t])>o+h)return!1;for(let t=0;t<3;t++)if(o=e.e[0]*r[0][t]+e.e[1]*r[1][t]+e.e[2]*r[2][t],h=i.e[t],Math.abs(a[0]*n[0][t]+a[1]*n[1][t]+a[2]*n[2][t])>o+h)return!1;return o=e.e[1]*r[2][0]+e.e[2]*r[1][0],h=i.e[1]*r[0][2]+i.e[2]*r[0][1],!(Math.abs(a[2]*n[1][0]-a[1]*n[2][0])>o+h)&&(o=e.e[1]*r[2][1]+e.e[2]*r[1][1],h=i.e[0]*r[0][2]+i.e[2]*r[0][0],!(Math.abs(a[2]*n[1][1]-a[1]*n[2][1])>o+h)&&(o=e.e[1]*r[2][2]+e.e[2]*r[1][2],h=i.e[0]*r[0][1]+i.e[1]*r[0][0],!(Math.abs(a[2]*n[1][2]-a[1]*n[2][2])>o+h)&&(o=e.e[0]*r[2][0]+e.e[2]*r[0][0],h=i.e[1]*r[1][2]+i.e[2]*r[1][1],!(Math.abs(a[0]*n[2][0]-a[2]*n[0][0])>o+h)&&(o=e.e[0]*r[2][1]+e.e[2]*r[0][1],h=i.e[0]*r[1][2]+i.e[2]*r[1][0],!(Math.abs(a[0]*n[2][1]-a[2]*n[0][1])>o+h)&&(o=e.e[0]*r[2][2]+e.e[2]*r[0][2],h=i.e[0]*r[1][1]+i.e[1]*r[1][0],!(Math.abs(a[0]*n[2][2]-a[2]*n[0][2])>o+h)&&(o=e.e[0]*r[1][0]+e.e[1]*r[0][0],h=i.e[1]*r[2][2]+i.e[2]*r[2][1],!(Math.abs(a[1]*n[0][0]-a[0]*n[1][0])>o+h)&&(o=e.e[0]*r[1][1]+e.e[1]*r[0][1],h=i.e[0]*r[2][2]+i.e[2]*r[2][0],!(Math.abs(a[1]*n[0][1]-a[0]*n[1][1])>o+h)&&(o=e.e[0]*r[1][2]+e.e[1]*r[0][2],h=i.e[0]*r[2][1]+i.e[1]*r[2][0],!(Math.abs(a[1]*n[0][2]-a[0]*n[1][2])>o+h)))))))))},intersectsPlane:function(t){this.rotation.extractBasis(s,o,h);const e=this.halfSize.x*Math.abs(t.normal.dot(s))+this.halfSize.y*Math.abs(t.normal.dot(o))+this.halfSize.z*Math.abs(t.normal.dot(h)),i=t.normal.dot(this.center)-t.constant;return Math.abs(i)<=e},intersectRay:function(t,e){var i,n,r,a;return this.getSize(l),S.setFromCenterAndSize(c.set(0,0,0),l),i=z,n=this.rotation,r=i.elements,a=n.elements,r[0]=a[0],r[1]=a[1],r[2]=a[2],r[3]=0,r[4]=a[3],r[5]=a[4],r[6]=a[5],r[7]=0,r[8]=a[6],r[9]=a[7],r[10]=a[8],r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,z.setPosition(this.center),m.copy(z).invert(),p.copy(t).applyMatrix4(m),p.intersectBox(S,e)?e.applyMatrix4(z):null},intersectsRay:function(t){return null!==this.intersectRay(t,c)},fromBox3:function(t){return t.getCenter(this.center),t.getSize(this.halfSize).multiplyScalar(.5),this.rotation.identity(),this},equals:function(t){return t.center.equals(this.center)&&t.halfSize.equals(this.halfSize)&&t.rotation.equals(this.rotation)},applyMatrix4:function(t){var e=t.elements,i=c.set(e[0],e[1],e[2]).length(),n=c.set(e[4],e[5],e[6]).length(),r=c.set(e[8],e[9],e[10]).length();t.determinant()<0&&(i=-i),f.setFromMatrix4(t);var a=1/i,s=1/n,o=1/r;return f.elements[0]*=a,f.elements[1]*=a,f.elements[2]*=a,f.elements[3]*=s,f.elements[4]*=s,f.elements[5]*=s,f.elements[6]*=o,f.elements[7]*=o,f.elements[8]*=o,this.rotation.multiply(f),this.halfSize.x*=i,this.halfSize.y*=n,this.halfSize.z*=r,c.setFromMatrixPosition(t),this.center.add(c),this}});var M=new y;exports.OBB=y;
