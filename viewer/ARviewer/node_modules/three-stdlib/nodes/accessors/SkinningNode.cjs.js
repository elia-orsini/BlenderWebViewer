"use strict";var e=require("../core/Node.cjs.js"),r=require("../ShaderNode.cjs.js"),s=require("../core/constants.cjs.js");require("../core/NodeUtils.cjs.js"),require("three"),require("../core/PropertyNode.cjs.js"),require("../core/VarNode.cjs.js"),require("../core/AttributeNode.cjs.js"),require("../core/VaryNode.cjs.js"),require("../core/ConstNode.cjs.js"),require("../core/InputNode.cjs.js"),require("../core/UniformNode.cjs.js"),require("./BufferNode.cjs.js"),require("./PositionNode.cjs.js"),require("@babel/runtime/helpers/defineProperty"),require("./ModelNode.cjs.js"),require("./Object3DNode.cjs.js"),require("../math/MathNode.cjs.js"),require("../core/TempNode.cjs.js"),require("../core/ExpressionNode.cjs.js"),require("../utils/JoinNode.cjs.js"),require("../utils/SplitNode.cjs.js"),require("../core/NodeBuilder.cjs.js"),require("../core/NodeUniform.cjs.js"),require("../core/NodeAttribute.cjs.js"),require("../core/NodeVary.cjs.js"),require("../core/NodeVar.cjs.js"),require("../core/NodeCode.cjs.js"),require("../core/NodeKeywords.cjs.js"),require("../math/OperatorNode.cjs.js"),require("./NormalNode.cjs.js"),require("./CameraNode.cjs.js"),require("./TextureNode.cjs.js"),require("./UVNode.cjs.js"),require("../math/CondNode.cjs.js"),require("../core/ContextNode.cjs.js"),require("../utils/ArrayElementNode.cjs.js"),require("../utils/ConvertNode.cjs.js");const i=new r.ShaderNode(((e,s)=>{const{index:i,weight:o,bindMatrix:t,bindMatrixInverse:d,boneMatrices:u}=e,c=r.element(u,i.x),n=r.element(u,i.y),j=r.element(u,i.z),a=r.element(u,i.w),N=r.mul(t,r.positionLocal),l=r.add(r.mul(r.mul(c,N),o.x),r.mul(r.mul(n,N),o.y),r.mul(r.mul(j,N),o.z),r.mul(r.mul(a,N),o.w)),m=r.mul(d,l).xyz;let q=r.add(r.mul(o.x,c),r.mul(o.y,n),r.mul(o.z,j),r.mul(o.w,a));q=r.mul(r.mul(d,q),t);const h=r.transformDirection(q,r.normalLocal).xyz;r.assign(r.positionLocal,m).build(s),r.assign(r.normalLocal,h).build(s)}));module.exports=class extends e{constructor(e){super("void"),this.skinnedMesh=e,this.updateType=s.NodeUpdateType.Object,this.skinIndexNode=r.attribute("skinIndex","uvec4"),this.skinWeightNode=r.attribute("skinWeight","vec4"),this.bindMatrixNode=r.uniform(r.mat4(e.bindMatrix)),this.bindMatrixInverseNode=r.uniform(r.mat4(e.bindMatrixInverse)),this.boneMatricesNode=r.buffer(e.skeleton.boneMatrices,"mat4",e.skeleton.bones.length)}generate(e){i({index:this.skinIndexNode,weight:this.skinWeightNode,bindMatrix:this.bindMatrixNode,bindMatrixInverse:this.bindMatrixInverseNode,boneMatrices:this.boneMatricesNode},e)}update(){this.skinnedMesh.skeleton.update()}};
