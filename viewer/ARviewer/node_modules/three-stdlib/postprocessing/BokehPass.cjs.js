"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("@babel/runtime/helpers/defineProperty"),r=require("./Pass.cjs.js"),t=require("three"),a=require("../shaders/BokehShader.cjs.js");function s(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var i=s(e);class l extends r.Pass{constructor(e,s,l){super(),i.default(this,"scene",void 0),i.default(this,"camera",void 0),i.default(this,"renderTargetDepth",void 0),i.default(this,"materialDepth",void 0),i.default(this,"materialBokeh",void 0),i.default(this,"fsQuad",void 0),i.default(this,"_oldClearColor",void 0),i.default(this,"uniforms",void 0),this.scene=e,this.camera=s;const h=void 0!==l.focus?l.focus:1,o=void 0!==l.aspect?l.aspect:s.aspect,n=void 0!==l.aperture?l.aperture:.025,d=void 0!==l.maxblur?l.maxblur:1,u=l.width||window.innerWidth||1,c=l.height||window.innerHeight||1;this.renderTargetDepth=new t.WebGLRenderTarget(u,c,{minFilter:t.NearestFilter,magFilter:t.NearestFilter}),this.renderTargetDepth.texture.name="BokehPass.depth",this.materialDepth=new t.MeshDepthMaterial,this.materialDepth.depthPacking=t.RGBADepthPacking,this.materialDepth.blending=t.NoBlending,void 0===a.BokehShader&&console.error("BokehPass relies on BokehShader");const f=a.BokehShader,p=t.UniformsUtils.clone(f.uniforms);p.tDepth.value=this.renderTargetDepth.texture,p.focus.value=h,p.aspect.value=o,p.aperture.value=n,p.maxblur.value=d,p.nearClip.value=s.near,p.farClip.value=s.far,this.materialBokeh=new t.ShaderMaterial({defines:Object.assign({},f.defines),uniforms:p,vertexShader:f.vertexShader,fragmentShader:f.fragmentShader}),this.uniforms=p,this.needsSwap=!1,this.fsQuad=new r.FullScreenQuad(this.materialBokeh),this._oldClearColor=new t.Color}render(e,r,t){this.scene.overrideMaterial=this.materialDepth,e.getClearColor(this._oldClearColor);const a=e.getClearAlpha(),s=e.autoClear;e.autoClear=!1,e.setClearColor(16777215),e.setClearAlpha(1),e.setRenderTarget(this.renderTargetDepth),e.clear(),e.render(this.scene,this.camera),this.uniforms.tColor.value=t.texture,this.uniforms.nearClip.value=this.camera.near,this.uniforms.farClip.value=this.camera.far,this.renderToScreen?(e.setRenderTarget(null),this.fsQuad.render(e)):(e.setRenderTarget(r),e.clear(),this.fsQuad.render(e)),this.scene.overrideMaterial=null,e.setClearColor(this._oldClearColor),e.setClearAlpha(a),e.autoClear=s}}exports.BokehPass=l;
