"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("three"),t=require("./SSAARenderPass.cjs.js");require("./Pass.cjs.js"),require("@babel/runtime/helpers/defineProperty"),require("../shaders/CopyShader.cjs.js");var r=function(e,r,s,a){void 0===t.SSAARenderPass&&console.error("THREE.TAARenderPass relies on SSAARenderPass"),t.SSAARenderPass.call(this,e,r,s,a),this.sampleLevel=0,this.accumulate=!1};r.JitterVectors=t.SSAARenderPass.JitterVectors,r.prototype=Object.assign(Object.create(t.SSAARenderPass.prototype),{constructor:r,render:function(s,a,i,h){if(!this.accumulate)return t.SSAARenderPass.prototype.render.call(this,s,a,i,h),void(this.accumulateIndex=-1);var n=r.JitterVectors[5];this.sampleRenderTarget||(this.sampleRenderTarget=new e.WebGLRenderTarget(i.width,i.height,this.params),this.sampleRenderTarget.texture.name="TAARenderPass.sample"),this.holdRenderTarget||(this.holdRenderTarget=new e.WebGLRenderTarget(i.width,i.height,this.params),this.holdRenderTarget.texture.name="TAARenderPass.hold"),this.accumulate&&-1===this.accumulateIndex&&(t.SSAARenderPass.prototype.render.call(this,s,this.holdRenderTarget,i,h),this.accumulateIndex=0);var c=s.autoClear;s.autoClear=!1;var d=1/n.length;if(this.accumulateIndex>=0&&this.accumulateIndex<n.length){this.copyUniforms.opacity.value=d,this.copyUniforms.tDiffuse.value=a.texture;var l=Math.pow(2,this.sampleLevel);for(let e=0;e<l;e++){var u=n[this.accumulateIndex];if(this.camera.setViewOffset&&this.camera.setViewOffset(i.width,i.height,.0625*u[0],.0625*u[1],i.width,i.height),s.setRenderTarget(a),s.clear(),s.render(this.scene,this.camera),s.setRenderTarget(this.sampleRenderTarget),0===this.accumulateIndex&&s.clear(),this.fsQuad.render(s),this.accumulateIndex++,this.accumulateIndex>=n.length)break}this.camera.clearViewOffset&&this.camera.clearViewOffset()}var o=this.accumulateIndex*d;o>0&&(this.copyUniforms.opacity.value=1,this.copyUniforms.tDiffuse.value=this.sampleRenderTarget.texture,s.setRenderTarget(a),s.clear(),this.fsQuad.render(s)),o<1&&(this.copyUniforms.opacity.value=1-o,this.copyUniforms.tDiffuse.value=this.holdRenderTarget.texture,s.setRenderTarget(a),0===o&&s.clear(),this.fsQuad.render(s)),s.autoClear=c}}),exports.TAARenderPass=r;
