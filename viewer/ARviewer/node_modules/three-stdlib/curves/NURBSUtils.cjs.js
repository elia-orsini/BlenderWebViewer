"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var t=require("three");function e(t,e,o){const r=o.length-t-1;if(e>=o[r])return r-1;if(e<=o[t])return t;let l=t,n=r,c=Math.floor((l+n)/2);for(;e<o[c]||e>=o[c+1];)e<o[c]?n=c:l=c,c=Math.floor((l+n)/2);return c}function o(t,e,o,r){const l=[],n=[],c=[];l[0]=1;for(let s=1;s<=o;++s){n[s]=e-r[t+1-s],c[s]=r[t+s]-e;let o=0;for(let t=0;t<s;++t){const e=c[t+1],r=n[s-t],i=l[t]/(e+r);l[t]=o+e*i,o=r*i}l[s]=o}return l}function r(t,e,o,r,l){const n=[];for(let t=0;t<=o;++t)n[t]=0;const c=[];for(let t=0;t<=r;++t)c[t]=n.slice(0);const s=[];for(let t=0;t<=o;++t)s[t]=n.slice(0);s[0][0]=1;const i=n.slice(0),f=n.slice(0);for(let r=1;r<=o;++r){i[r]=e-l[t+1-r],f[r]=l[t+r]-e;let o=0;for(let t=0;t<r;++t){const e=f[t+1],l=i[r-t];s[r][t]=e+l;const n=s[t][r-1]/s[r][t];s[t][r]=o+e*n,o=l*n}s[r][r]=o}for(let t=0;t<=o;++t)c[0][t]=s[t][o];for(let t=0;t<=o;++t){let e=0,l=1;const i=[];for(let t=0;t<=o;++t)i[t]=n.slice(0);i[0][0]=1;for(let n=1;n<=r;++n){let r=0;const f=t-n,u=o-n;t>=n&&(i[l][0]=i[e][0]/s[u+1][f],r=i[l][0]*s[f][u]);const p=t-1<=u?n-1:o-t;for(let t=f>=-1?1:-f;t<=p;++t)i[l][t]=(i[e][t]-i[e][t-1])/s[u+1][f+t],r+=i[l][t]*s[f+t][u];t<=u&&(i[l][n]=-i[e][n-1]/s[u+1][t],r+=i[l][n]*s[t][u]),c[n][t]=r;var a=e;e=l,l=a}}var u=o;for(let t=1;t<=r;++t){for(let e=0;e<=o;++e)c[t][e]*=u;u*=o-t}return c}function l(o,l,n,c,s){const i=s<o?s:o,f=[],a=e(o,c,l),u=r(a,c,o,i,l),p=[];for(let t=0;t<n.length;++t){const e=(v=n[t].clone()).w;v.x*=e,v.y*=e,v.z*=e,p[t]=v}for(let t=0;t<=i;++t){var v=p[a-o].clone().multiplyScalar(u[t][0]);for(let e=1;e<=o;++e)v.add(p[a-o+e].clone().multiplyScalar(u[t][e]));f[t]=v}for(let e=i+1;e<=s+1;++e)f[e]=new t.Vector4(0,0,0);return f}function n(t,e){let o=1;for(let e=2;e<=t;++e)o*=e;let r=1;for(let t=2;t<=e;++t)r*=t;for(let o=2;o<=t-e;++o)r*=o;return o/r}function c(e){const o=e.length,r=[],l=[];for(let n=0;n<o;++n){const o=e[n];r[n]=new t.Vector3(o.x,o.y,o.z),l[n]=o.w}const c=[];for(let t=0;t<o;++t){const e=r[t].clone();for(let o=1;o<=t;++o)e.sub(c[t-o].clone().multiplyScalar(n(t,o)*l[o]));c[t]=e.divideScalar(l[0])}return c}exports.calcBSplineDerivatives=l,exports.calcBSplinePoint=function(r,l,n,c){const s=e(r,c,l),i=o(s,c,r,l),f=new t.Vector4(0,0,0,0);for(let t=0;t<=r;++t){const e=n[s-r+t],o=i[t],l=e.w*o;f.x+=e.x*l,f.y+=e.y*l,f.z+=e.z*l,f.w+=e.w*o}return f},exports.calcBasisFunctionDerivatives=r,exports.calcBasisFunctions=o,exports.calcKoverI=n,exports.calcNURBSDerivatives=function(t,e,o,r,n){return c(l(t,e,o,r,n))},exports.calcRationalCurveDerivatives=c,exports.calcSurfacePoint=function(r,l,n,c,s,i,f,a){const u=e(r,i,n),p=e(l,f,c),v=o(u,i,r,n),x=o(p,f,l,c),d=[];for(let e=0;e<=l;++e){d[e]=new t.Vector4(0,0,0,0);for(let t=0;t<=r;++t){const o=s[u-r+t][p-l+e].clone(),n=o.w;o.x*=n,o.y*=n,o.z*=n,d[e].add(o.multiplyScalar(v[t]))}}const w=new t.Vector4(0,0,0,0);for(let t=0;t<=l;++t)w.add(d[t].multiplyScalar(x[t]));w.divideScalar(w.w),a.set(w.x,w.y,w.z)},exports.findSpan=e;
