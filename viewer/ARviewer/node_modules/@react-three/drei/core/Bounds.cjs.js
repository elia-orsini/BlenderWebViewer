"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("react"),t=require("three"),r=require("@react-three/fiber");function o(e){if(e&&e.__esModule)return e;var t=Object.create(null);return e&&Object.keys(e).forEach((function(r){if("default"!==r){var o=Object.getOwnPropertyDescriptor(e,r);Object.defineProperty(t,r,o.get?o:{enumerable:!0,get:function(){return e[r]}})}})),t.default=e,Object.freeze(t)}var a=o(e),n=o(t);const c=e=>e&&e.isOrthographicCamera,i=a.createContext(null);exports.Bounds=function({children:e,damping:t=6,fit:o,clip:s,observe:u,margin:m=1.2,eps:f=.01,onFit:l}){const p=a.useRef(null),{camera:x,invalidate:y,size:z,controls:d}=r.useThree(),h=a.useRef(l);function M(e,t){return Math.abs(e.x-t.x)<f&&Math.abs(e.y-t.y)<f&&Math.abs(e.z-t.z)<f}function g(e,t,r,o){e.x=n.MathUtils.damp(e.x,t.x,r,o),e.y=n.MathUtils.damp(e.y,t.y,r,o),e.z=n.MathUtils.damp(e.z,t.z,r,o)}h.current=l;const[b]=a.useState((()=>({animating:!1,focus:new n.Vector3,camera:new n.Vector3,zoom:1}))),[w]=a.useState((()=>({focus:new n.Vector3,camera:new n.Vector3,zoom:1}))),[v]=a.useState((()=>new n.Box3)),V=a.useMemo((()=>{function e(){const e=v.getSize(new n.Vector3),t=v.getCenter(new n.Vector3),r=Math.max(e.x,e.y,e.z),o=c(x)?4*r:r/(2*Math.atan(Math.PI*x.fov/360)),a=c(x)?4*r:o/x.aspect,i=m*Math.max(o,a);return{box:v,size:e,center:t,distance:i}}return{getSize:e,refresh(t){if((r=t)&&r.isBox3)v.copy(t);else{const e=t||p.current;e.updateWorldMatrix(!0,!0),v.setFromObject(e)}var r;if(v.isEmpty()){const e=x.position.length()||10;v.setFromCenterAndSize(new n.Vector3,new n.Vector3(e,e,e))}if("OrthographicTrackballControls"===(null==d?void 0:d.constructor.name)){const{distance:t}=e(),r=x.position.clone().sub(d.target).normalize().multiplyScalar(t),o=d.target.clone().add(r);x.position.copy(o)}return this},clip(){const{distance:t}=e();return d&&(d.maxDistance=10*t),x.near=t/100,x.far=100*t,x.updateProjectionMatrix(),d&&d.update(),y(),this},fit(){b.camera.copy(x.position),d&&b.focus.copy(d.target);const{center:r,distance:o}=e(),a=r.clone().sub(x.position).normalize().multiplyScalar(o);if(w.camera.copy(r).sub(a),w.focus.copy(r),c(x)){b.zoom=x.zoom;let e=0,o=0;const a=[new n.Vector3(v.min.x,v.min.y,v.min.z),new n.Vector3(v.min.x,v.max.y,v.min.z),new n.Vector3(v.min.x,v.min.y,v.max.z),new n.Vector3(v.min.x,v.max.y,v.max.z),new n.Vector3(v.max.x,v.max.y,v.max.z),new n.Vector3(v.max.x,v.max.y,v.min.z),new n.Vector3(v.max.x,v.min.y,v.max.z),new n.Vector3(v.max.x,v.min.y,v.min.z)];r.applyMatrix4(x.matrixWorldInverse);for(const t of a)t.applyMatrix4(x.matrixWorldInverse),e=Math.max(e,Math.abs(t.y-r.y)),o=Math.max(o,Math.abs(t.x-r.x));e*=2,o*=2;const c=(x.top-x.bottom)/e,i=(x.right-x.left)/o;w.zoom=Math.min(c,i)/m,t||(x.zoom=w.zoom,x.updateProjectionMatrix())}return t?b.animating=!0:(x.position.copy(w.camera),x.lookAt(w.focus),d&&(d.target.copy(w.focus),d.update())),h.current&&h.current(this.getSize()),y(),this}}}),[v,x,d,m,t,y]);a.useLayoutEffect((()=>{if(d){const e=()=>b.animating=!1;return d.addEventListener("start",e),()=>d.removeEventListener("start",e)}}),[d]);const j=a.useRef(0);return a.useLayoutEffect((()=>{(u||0==j.current++)&&(V.refresh(),o&&V.fit(),s&&V.clip())}),[z,s,o,u]),r.useFrame(((e,r)=>{if(b.animating){if(g(b.focus,w.focus,t,r),g(b.camera,w.camera,t,r),b.zoom=n.MathUtils.damp(b.zoom,w.zoom,t,r),x.position.copy(b.camera),c(x)&&(x.zoom=b.zoom,x.updateProjectionMatrix()),d?(d.target.copy(b.focus),d.update()):x.lookAt(b.focus),y(),c(x)&&!(Math.abs(b.zoom-w.zoom)<f))return;if(!c(x)&&!M(b.camera,w.camera))return;if(d&&!M(b.focus,w.focus))return;b.animating=!1}})),a.createElement("group",{ref:p},a.createElement(i.Provider,{value:V},e))},exports.useBounds=function(){return a.useContext(i)};
